<div class="container">
  <div class="header">Important Tasks</div>

  <form class="add-form" (ngSubmit)="addTask()">
    <mat-form-field appearance="outline">
      <input matInput placeholder="New task" [(ngModel)]="newTask.title" name="label" required>
    </mat-form-field>
    <mat-form-field appearance="outline">
      <mat-select placeholder="Label" [(ngModel)]="newTask.labelId" name="newLabelId" required>
        <mat-option *ngFor="let label of labels" [value]="label.id">{{ label.name }}</mat-option>
      </mat-select>
    </mat-form-field>
    <button mat-raised-button color="primary" type="submit">Add</button>
  </form>

  <div *ngFor="let task of tasks" class="task-item">
    <ng-container *ngIf="editingTaskId !== task.id; else editMode">
      <span [ngClass]="{'task-label': true, 'completed': task.completed}">
        {{ task.title }}
      </span>
      <mat-form-field appearance="outline" class="label-select">
        <mat-select [value]="task.labelId" (selectionChange)="onLabelChange(task, $event.value)">
          <mat-option *ngFor="let label of labels" [value]="label.id">{{ label.name }}</mat-option>
        </mat-select>
      </mat-form-field>
      <input type="checkbox" [checked]="task.completed" (change)="toggleCompleted(task)">
      <span class="action-btns">
        <button mat-icon-button color="accent" (click)="startEdit(task)">
          <mat-icon>edit</mat-icon>
        </button>
        <button mat-icon-button color="warn" (click)="deleteTask(task)">
          <mat-icon>delete</mat-icon>
        </button>
      </span>
    </ng-container>
    <ng-template #editMode>
      <mat-form-field appearance="outline" class="edit-title">
        <input matInput [(ngModel)]="editTask.title" name="editTitle{{task.id}}">
      </mat-form-field>
      <mat-form-field appearance="outline" class="edit-label">
        <mat-select [(ngModel)]="editTask.labelId" name="editLabelId{{task.id}}">
          <mat-option *ngFor="let label of labels" [value]="label.id">{{ label.name }}</mat-option>
        </mat-select>
      </mat-form-field>
      <span class="action-btns">
        <button mat-icon-button color="primary" (click)="saveEdit(task)">
          <mat-icon>check</mat-icon>
        </button>
        <button mat-icon-button (click)="cancelEdit()">
          <mat-icon>close</mat-icon>
        </button>
      </span>
    </ng-template>
  </div>
</div>
